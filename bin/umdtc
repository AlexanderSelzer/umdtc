#!/usr/bin/env node

var argv = require("minimist")(process.argv.slice(2))
var chalk = require("chalk")

var config = {
  "server": "localhost:8080",
  "interface": "wlp0s20u1u1",
  "gpsd_port": 2947,
}

if (argv.h || argv.help) {
  console.log(
    "--server {host:port}\n" +
    "--if {name}\n" +
    "--gpsd-port {port}\n" + 
    "--fixed-pos {lat} {lon}\n" +
    "--gps-timeout {seconds}\n"
      )
  process.exit(0)
}

// Alternative server addresses
if (!argv.server)
  console.log("server: " + chalk.green(config.server) + "\t (specify a server with " + chalk.blue("--server") + ")")
else
  config.server = argv.server

// Alternative interface
if (!argv.if)
  console.log("interface: " + chalk.green(config.interface) + "\t (select a network interface with " + chalk.blue("--if") + ")")
else
  config.interface = argv.if

// the GPSd port is basically always the default one
if (argv["gpsd-port"])
  config.gpsd_port = argv["gpsd-port"]

// not sure if this is a good idea...
if (argv["fixed-pos"]) {
  if (!argv.lat || !argv.lon) {
    console.log(chalk.red("error: ") + "--lat and --lon")
    process.exit(1)
  }
  else {
    config["fixed-pos"] = true
    config.lat = parseFloat(argv.lat)
    config.lon = parseFloat(argv.lon)
  }
}

// Sometimes the GPS signal is just bad, and you don't move.
if (argv["gps-timeout"]) {
  config.gps_timeout = parseInt(argv["gps-timeout"])
}

console.log("warning: ignore warning below")

require("../umdtc.js")(config)
