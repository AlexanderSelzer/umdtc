#!/usr/bin/env node

var argv = require("minimist")(process.argv.slice(2))
var chalk = require("chalk")

var config = {
  "server": "localhost:8080",
  "interface": "wlp0s20u1u1",
  "gpsd_port": 2947,
  "fixed_pos": false,
  "monitor": false
}

if (argv.h || argv.help) {
  console.log(
    "--server | -s     {host:port}\n" +
    "--if | -i         {name}\n" +
    "--gpsd-port       {port}\n" + 
    "--fixed-pos --lat {lat} --lon {lon}\n" +
    "--gps-timeout     {seconds}\n"
      )
  process.exit(0)
}

// Alternative server addresses
var server = argv.server || argv.s
if (!server)
  console.log("server: " + chalk.green(config.server) + "\t (specify a server with " + chalk.blue("--server") + ")")
else
  config.server = server

// Alternative interface name
var interface = argv.if || argv.i
if (!interface)
  console.log("interface: " + chalk.green(config.interface) + "\t (select a network interface with " + chalk.blue("--if") + ")")
else
  config.interface = interface

/*
var monitor = argv.monitor || argv.m
if (monitor)
  config.monitor = true
  */

// the GPSd port is basically always the default one
if (argv["gpsd-port"])
  config.gpsd_port = argv["gpsd-port"]

// not sure if this is a good idea...
if (argv["fixed-pos"]) {
  if (!argv.lat || !argv.lon) {
    console.log(chalk.red("error: ") + "see umdtc -h")
    process.exit(1)
  }
  else {
    config.fixed_pos = true
    config.lat = parseFloat(argv.lat)
    config.lon = parseFloat(argv.lon)
  }
}

// Sometimes the GPS signal is just bad, and you don't move.
if (argv["gps-timeout"]) {
  config.gps_timeout = parseInt(argv["gps-timeout"])
}

console.log("warning: ignore warning below")

require("../umdtc.js")(config)
